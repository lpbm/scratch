$(document).ready(function(){function f(a,c){var b={};b.uri=$(location).attr("href");if(typeof a!="undefined"&&a!=null)b.key=a;b.action=typeof c!="undefined"&&c=="update"?c:"check";if(d!=null)b.auth_token=d;$.ajax({url:"/check/",dataType:"json",type:"post",data:b,success:function(a){a.status=="nok"?(g.addClass("locked").fadeIn("slow").fadeOut("slow"),e.stopEditing()):(g.addClass("unlocked"),e.startEditing(),d=a.auth_token)}})}var e=$("#content"),h=$("<div/>").addClass("feedback").insertBefore(e), g=$("<a/>").addClass("icon").appendTo(h).hide(),d=null;$(".feedback").mouseenter(function(){$(this).children("a").fadeIn("slow")}).mouseleave(function(){$(this).children("a").fadeOut("slow")});f();g.click(function(){var a=prompt("Please enter the secret key for this page.","");a!=null&&$(this).hasClass("unlocked")?f(a,"update"):f(a,"check")});e.startEditing().keyup(function(a){var c=[27],b=[16];if([9,13,32,190].indexOf(a.keyCode)!=-1||a.ctrlKey&&c.indexOf(a.keyCode)!=-1||a.shiftKey&&b.indexOf(a.keyCode)!= -1)a={content:$(this).html(),auth_token:d},$.ajax({url:"/save/",dataType:"json",type:"post",data:a})})});