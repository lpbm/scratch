$(document).ready(function(){function e(a,f){var c={};c.uri=$(location).attr("href");if(typeof a!="undefined"&&a!=null)c.key=a;c.action=typeof f!="undefined"&&f=="update"?f:"check";if(d!=null)c.auth_token=d;$.ajax({url:"/",dataType:"json",type:"post",data:c,success:function(a){a.status=="ko"?(g.addClass("locked").fadeIn("slow").fadeOut("slow"),b.fresheditor("edit",!1)):(g.addClass("unlocked").fadeIn("slow").fadeOut("slow"),b.fresheditor("edit",!0),d=a.auth_token)}})}function j(a){return a!=i}var b= $("#content"),k=$("<div/>").addClass("feedback").insertBefore(b),g=$("<a/>").addClass("icon").appendTo(k).hide(),d=null,i=b.html(),h=!1;e();b.fresheditor();setInterval(function(){!h&&j(b.html())&&b.fresheditor("save",function(a,b){var c={action:"save",content:b,auth_token:d};$.ajax({url:"/",dataType:"json",type:"post",data:c,beforeSend:function(){h=!0},success:function(a){a.status!="ok"?console.debug("Err: "+a.message):i=c.content},complete:function(){h=!1}})})},5E3);$(".feedback").mouseenter(function(){$(this).children("a").fadeIn("slow")}).mouseleave(function(){$(this).children("a").fadeOut("slow")}); g.click(function(){var a=prompt("Please enter the secret key for this page.","");a!=null&&($(this).hasClass("unlocked")?e(a,"update"):e(a,"check"))})});