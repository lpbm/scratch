var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-110656-5"]);_gaq.push(["_trackPageview"]);(function(){var b=document.createElement("script");b.type="text/javascript";b.async=!0;b.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(b,e)})();
$(document).ready(function(){function b(a,b){var d={};d.uri=$(location).attr("href");if(typeof a!="undefined"&&a!=null)d.key=a;d.action=typeof b!="undefined"&&b=="update"?b:"check";if(f!=null)d.auth_token=f;$.ajax({url:"/",dataType:"json",type:"post",data:d,success:function(a){a.status=="ko"?(g.addClass("locked").fadeIn("slow").fadeOut("slow"),c.fresheditor("edit",!1)):(g.addClass("unlocked").fadeIn("slow").fadeOut("slow"),c.fresheditor("edit",!0),f=a.auth_token)}})}function e(a){return a!=k}function l(){var a=
new Date;!h&&e(c.html())&&a.getTime()-i.getTime()>j&&c.fresheditor("save",function(a,b){var c={action:"save",content:b,auth_token:f};$.ajax({url:"/",dataType:"json",type:"post",data:c,beforeSend:function(){m=new Date;h=!0;k=c.content},success:function(a){a.status!="ok"&&console.debug("Err: "+a.message)},complete:function(){h=!1;i=new Date;j=(i.getTime()-m.getTime())*2}})})}var c=$("#content"),j=3E3,m=new Date,i=new Date,n=$("<div/>").addClass("feedback").insertBefore(c),g=$("<a/>").addClass("icon").appendTo(n).hide();
$(".feedback").mouseenter(function(){$(this).children("a").fadeIn("slow")}).mouseleave(function(){$(this).children("a").fadeOut("slow")});g.click(function(){var a=prompt("Please enter the secret key for this page.","");a!=null&&($(this).hasClass("unlocked")?b(a,"update"):b(a,"check"))});var f=null,k=c.html(),h=!1;b();c.fresheditor().keyup(function(a){var b=[27,83,90],c=[16],a=a.ctrlKey&&b.indexOf(a.keyCode)!=-1?!0:a.shiftKey&&c.indexOf(a.keyCode)!=-1?!0:[8,9,13,32,46,190].indexOf(a.keyCode)!=-1?!0:
!1;a&&l()});setInterval(function(){l()},j)});