$(document).ready(function(){function f(a,c){var b={};b.uri=$(location).attr("href");if(typeof a!="undefined"&&a!=null)b.key=a;b.action=typeof c!="undefined"&&c=="update"?c:"check";if(e!=null)b.auth_token=e;$.ajax({url:"/s/",dataType:"json",type:"post",data:b,success:function(a){a.status=="ko"?(g.addClass("locked").fadeIn("slow").fadeOut("slow"),d.fresheditor("edit",!1)):(g.addClass("unlocked").fadeIn("slow").fadeOut("slow"),d.fresheditor("edit",!0),e=a.auth_token)}})}function i(a){var c=[33,34,35, 36,37,38,39,40],b=[27,83,90],d=[16];c.indexOf(a.keyCode)==-1&&(h=!0);return a.ctrlKey&&(b.indexOf(a.keyCode)!=-1||c.indexOf(a.keyCode))?!0:a.shiftKey&&d.indexOf(a.keyCode)!=-1?!0:[8,9,13,32,46,190].indexOf(a.keyCode)!=-1||c.indexOf(a.keyCode)!=-1?!0:!1}var d=$("#content"),j=$("<div/>").addClass("feedback").insertBefore(d),g=$("<a/>").addClass("icon").appendTo(j).hide(),e=null,h=!1;f();d.fresheditor().keyup(function(a){i(a)&&h&&d.fresheditor("save",function(a,b){$.ajax({url:"/s/",dataType:"json",type:"post", data:{action:"save",content:b,auth_token:e},success:function(a){a.status!="ok"?console.debug("Err: "+a.message):h=!1}})})});$(".feedback").mouseenter(function(){$(this).children("a").fadeIn("slow")}).mouseleave(function(){$(this).children("a").fadeOut("slow")});g.click(function(){var a=prompt("Please enter the secret key for this page.","");a!=null&&($(this).hasClass("unlocked")?f(a,"update"):f(a,"check"))})});