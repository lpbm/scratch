var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-110656-5"]);_gaq.push(["_trackPageview"]);(function(){var b=document.createElement("script");b.type="text/javascript";b.async=!0;b.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(b,e)})();
$(document).ready(function(){function b(a,b){var d={};d.uri=$(location).attr("href");if(typeof a!="undefined"&&a!=null)d.key=a;d.action=typeof b!="undefined"&&b=="update"?b:"check";if(f!=null)d.auth_token=f;$.ajax({url:"/",dataType:"json",type:"post",data:d,success:function(a){a.status=="ko"?(h.addClass("locked").fadeIn("slow").fadeOut("slow"),c.fresheditor("edit",!1)):(h.addClass("unlocked").fadeIn("slow").fadeOut("slow"),c.fresheditor("edit",!0),f=a.auth_token)}})}function e(a){return a!=k}function l(){var a=
new Date;!i&&e(c.html())&&a.getTime()-j.getTime()>g&&c.fresheditor("save",function(a,b){var c={action:"save",content:b,auth_token:f};console.debug(g);$.ajax({url:"/",dataType:"json",type:"post",data:c,beforeSend:function(){m=new Date;i=!0;k=c.content},success:function(a){a.status!="ok"&&console.debug("Err: "+a.message)},complete:function(){i=!1;j=new Date;var a=j.getTime()-m.getTime(),b=2;a>1E3?b=1:a<400?b=10:a<100&&(b=20);g=a*b}})})}var c=$("#content"),g=3E3,m=new Date,j=new Date,n=$("<div/>").addClass("feedback").insertBefore(c),
h=$("<a/>").addClass("icon").appendTo(n).hide();$(".feedback").mouseenter(function(){$(this).children("a").fadeIn("slow")}).mouseleave(function(){$(this).children("a").fadeOut("slow")});h.click(function(){var a=prompt("Please enter the secret key for this page.","");a!=null&&($(this).hasClass("unlocked")?b(a,"update"):b(a,"check"))});var f=null,k=c.html(),i=!1;b();c.fresheditor().keyup(function(a){var b=[27,83,90],c=[16],a=a.ctrlKey&&b.indexOf(a.keyCode)!=-1?!0:a.shiftKey&&c.indexOf(a.keyCode)!=-1?
!0:[8,9,13,32,46,190].indexOf(a.keyCode)!=-1?!0:!1;a&&l()});setInterval(function(){l()},g)});